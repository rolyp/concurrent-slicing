module Transition.Concur.Cofinal.Lattice.case.nu-propagate-b-c where

   open import ConcurrentSlicingCommon
   import Name as ·¥∫
   import Ren as ·¥ø
   open import Transition.Concur.Cofinal.Lattice.Common

   private
      base : ‚àÄ {Œì P‚ÇÄ R‚ÇÄ R‚Ä≤‚ÇÄ} {a : Action·µá Œì} {a‚Ä≤ : Action·∂ú Œì} {E : P‚ÇÄ ‚Äî[ (·¥ø.push *) a ·µá - _ ]‚Üí R‚ÇÄ}
             {E‚Ä≤ : P‚ÇÄ ‚Äî[ (·¥ø.push *) a‚Ä≤ ·∂ú - _ ]‚Üí R‚Ä≤‚ÇÄ} (ùê∏ : E ‚å£‚ÇÅ[ ·µá‚àá·∂ú ] E‚Ä≤) (P : ‚Üì P‚ÇÄ) (R : ‚Üì R‚ÇÄ) (R‚Ä≤ : ‚Üì R‚Ä≤‚ÇÄ)
             (S : ‚Üì (·¥ø.swap *) (tgt‚ÇÅ (‚äñ‚ÇÅ ùê∏))) (S‚Ä≤ : ‚Üì tgt‚ÇÇ (‚äñ‚ÇÅ ùê∏)) ‚Üí
             tgt E P ‚â° R ‚Üí tgt E‚Ä≤ P ‚â° R‚Ä≤ ‚Üí tgt ((·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏))) ((swap *ÃÉ) R) ‚â° S ‚Üí tgt (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) R‚Ä≤ ‚â° S‚Ä≤ ‚Üí
             braiding (·µá‚àá·∂ú {a = (·¥ø.push *) a} {(·¥ø.push *) a‚Ä≤}) {0} (Œ≥‚ÇÅ ùê∏) (tgt (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏)) (tgt E P)) ‚â°
             tgt (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) (tgt E‚Ä≤ P) ‚Üí
             braiding (·µá‚àá·∂ú {a = a} {a‚Ä≤}) {0} (cong ŒΩ_ (cong (·¥ø.swap *) (Œ≥‚ÇÅ ùê∏)))
             [ ŒΩ S ] ‚â° [ ŒΩ (swap *ÃÉ) S‚Ä≤ ]
      base {a = a} {a‚Ä≤} {E} {E‚Ä≤} ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ ‚â°S ‚â°S‚Ä≤ IH =
         let Œ± : S ‚âÖ (swap *ÃÉ) S‚Ä≤
             Œ± = let open ‚âÖ-Reasoning in
                begin
                   S
                ‚â°‚ü® sym ‚â°S ‚ü©
                   tgt ((·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏))) ((swap *ÃÉ) R)
                ‚â°‚ü® cong (tgt ((·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏))) ‚àò·∂† (swap *ÃÉ)) (sym ‚â°R) ‚ü©
                   tgt ((·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏))) ((swap *ÃÉ) (tgt E P))
                ‚â°‚ü® sym (ren·∂ú-tgt-comm (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏)) swap (tgt E P)) ‚ü©
                   (swap *ÃÉ) (tgt (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏)) (tgt E P))
                ‚âÖ‚ü® ‚âÖ-cong‚ú¥ ‚Üì_ (Œ≥‚ÇÅ ùê∏) (swap *ÃÉ) (‚âÖ-sym (reduce-·µá‚àá·∂ú (Œ≥‚ÇÅ ùê∏) _)) ‚ü©
                   (swap *ÃÉ) (braiding ·µá‚àá·∂ú {0} (Œ≥‚ÇÅ ùê∏) (tgt (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏)) (tgt E P)))
                ‚â°‚ü® cong (swap *ÃÉ) IH ‚ü©
                   (swap *ÃÉ) (tgt (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) (tgt E‚Ä≤ P))
                ‚â°‚ü® cong ((swap *ÃÉ) ‚àò·∂† tgt (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏))) ‚â°R‚Ä≤ ‚ü©
                   (swap *ÃÉ) (tgt (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) R‚Ä≤)
                ‚â°‚ü® cong (swap *ÃÉ) ‚â°S‚Ä≤ ‚ü©
                   (swap *ÃÉ) S‚Ä≤
                ‚àé
             open ‚âÖ-Reasoning in ‚âÖ-to-‚â° (
         begin
            braiding ·µá‚àá·∂ú (cong ŒΩ_ (cong (·¥ø.swap *) (Œ≥‚ÇÅ ùê∏))) [ ŒΩ S ]
         ‚âÖ‚ü® reduce-·µá‚àá·∂ú (cong ŒΩ_ (cong (·¥ø.swap *) (Œ≥‚ÇÅ ùê∏))) _  ‚ü©
            [ ŒΩ S ]
         ‚âÖ‚ü® [ŒΩ-]-cong (cong (·¥ø.swap *) (Œ≥‚ÇÅ ùê∏)) Œ± ‚ü©
            [ ŒΩ (swap *ÃÉ) S‚Ä≤ ]
         ‚àé)

   module x‚Ä¢-‚Ä¢x‚å©y‚å™
      {Œì P‚ÇÄ R‚ÇÄ R‚Ä≤‚ÇÄ} {x x‚Ä≤ y : Name Œì} {E : P‚ÇÄ ‚Äî[ ·¥ø.push x ‚Ä¢ ·µá - _ ]‚Üí R‚ÇÄ}
      {E‚Ä≤ : P‚ÇÄ ‚Äî[ ‚Ä¢ ·¥ø.push x‚Ä≤ ‚å© ·¥ø.push y ‚å™ ·∂ú - _ ]‚Üí R‚Ä≤‚ÇÄ} (ùê∏ : E ‚å£‚ÇÅ[ ·µá‚àá·∂ú ] E‚Ä≤) (P : ‚Üì P‚ÇÄ)
      (let P‚Ä≤‚ÇÄ = tgt‚ÇÅ (‚äñ‚ÇÅ ùê∏); P‚Ä≥‚ÇÄ = tgt‚ÇÇ (‚äñ‚ÇÅ ùê∏))
      (IH : braiding (·µá‚àá·∂ú {a = ·¥ø.push x ‚Ä¢} {‚Ä¢ ·¥ø.push x‚Ä≤ ‚å© ·¥ø.push y ‚å™}) {0} (Œ≥‚ÇÅ ùê∏)
            (tgt (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏)) (tgt E P)) ‚â° tgt (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) (tgt E‚Ä≤ P))
      where

      private
         module _
            (R : ‚Üì R‚ÇÄ) (R‚Ä≤ : ‚Üì R‚Ä≤‚ÇÄ) (‚â°R : tgt E P ‚â° R) (‚â°R‚Ä≤ : tgt E‚Ä≤ P ‚â° R‚Ä≤) where

            case‚Ä≤ :
               braiding (·µá‚àá·∂ú {a = x ‚Ä¢} {‚Ä¢ x‚Ä≤ ‚å© y ‚å™}) {0} (cong ŒΩ_ (cong (·¥ø.swap *) (Œ≥‚ÇÅ ùê∏)))
               (tgt (ŒΩ·∂ú (·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏))) [ ŒΩ (swap *ÃÉ) R ]) ‚â° tgt (ŒΩ·µá E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) [ ŒΩ R‚Ä≤ ]
            case‚Ä≤
               with step ((·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏))) ((swap *ÃÉ) R) | step (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) R‚Ä≤ |
                    inspect (step ((·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏)))) ((swap *ÃÉ) R) | inspect (step (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏))) R‚Ä≤
            case‚Ä≤ | ‚óª , S | ‚óª , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | ‚óª , S | [ ._ ‚Ä¢ ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ ‚Ä¢ ._ ‚å© ‚óª ‚å™ ·∂ú ] , S | ‚óª , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ ‚Ä¢ ._ ‚å© [ ._ ] ‚å™ ·∂ú ] , S | ‚óª , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ ‚Ä¢ ._ ‚å© ‚óª ‚å™ ·∂ú ] , S | [ ._ ‚Ä¢ ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ ‚Ä¢ ._ ‚å© [ ._ ] ‚å™ ·∂ú ] , S | [ ._ ‚Ä¢ ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH

      case :
         braiding (·µá‚àá·∂ú {a = x ‚Ä¢} {‚Ä¢ x‚Ä≤ ‚å© y ‚å™}) {0} (Œ≥‚ÇÅ (ŒΩ·µá·∂ú ùê∏))
         (tgt (E‚Ä≤/E (‚äñ‚ÇÅ (ŒΩ·µá·∂ú ùê∏))) (tgt (ŒΩ·µá E) [ ŒΩ P ])) ‚â° tgt (E/E‚Ä≤ (‚äñ‚ÇÅ (ŒΩ·µá·∂ú ùê∏))) (tgt (ŒΩ·∂ú E‚Ä≤) [ ŒΩ P ])
      case
         with step E‚Ä≤ P | step E P | inspect (step E‚Ä≤) P | inspect (step E) P
      ... | ‚óª , R‚Ä≤ | ‚óª , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | ‚óª , R‚Ä≤ | [ ._ ‚Ä¢ ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ ‚Ä¢ ._ ‚å© ‚óª ‚å™ ·∂ú ] , R‚Ä≤ | ‚óª , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ ‚Ä¢ ._ ‚å© [ ._ ] ‚å™ ·∂ú ] , R‚Ä≤ | ‚óª , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ ‚Ä¢ ._ ‚å© ‚óª ‚å™ ·∂ú ] , R‚Ä≤ | [ ._ ‚Ä¢ ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ ‚Ä¢ ._ ‚å© [ ._ ] ‚å™ ·∂ú ] , R‚Ä≤ | [ ._ ‚Ä¢ ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)

   module x‚Ä¢-œÑ
      {Œì P‚ÇÄ R‚ÇÄ R‚Ä≤‚ÇÄ} {x : Name Œì} {E : P‚ÇÄ ‚Äî[ ·¥ø.push x ‚Ä¢ ·µá - _ ]‚Üí R‚ÇÄ}
      {E‚Ä≤ : P‚ÇÄ ‚Äî[ œÑ ·∂ú - _ ]‚Üí R‚Ä≤‚ÇÄ} (ùê∏ : E ‚å£‚ÇÅ[ ·µá‚àá·∂ú ] E‚Ä≤) (P : ‚Üì P‚ÇÄ)
      (let P‚Ä≤‚ÇÄ = tgt‚ÇÅ (‚äñ‚ÇÅ ùê∏); P‚Ä≥‚ÇÄ = tgt‚ÇÇ (‚äñ‚ÇÅ ùê∏))
      (IH : braiding (·µá‚àá·∂ú {a = ·¥ø.push x ‚Ä¢} {œÑ}) {0} (Œ≥‚ÇÅ ùê∏)
            (tgt (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏)) (tgt E P)) ‚â° tgt (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) (tgt E‚Ä≤ P))
      where

      private
         module _
            (R : ‚Üì R‚ÇÄ) (R‚Ä≤ : ‚Üì R‚Ä≤‚ÇÄ) (‚â°R : tgt E P ‚â° R) (‚â°R‚Ä≤ : tgt E‚Ä≤ P ‚â° R‚Ä≤) where

            case‚Ä≤ :
               braiding (·µá‚àá·∂ú {a = x ‚Ä¢} {œÑ}) {0} (cong ŒΩ_ (cong (·¥ø.swap *) (Œ≥‚ÇÅ ùê∏)))
               (tgt (ŒΩ·∂ú (·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏))) [ ŒΩ (swap *ÃÉ) R ]) ‚â° tgt (ŒΩ·µá E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) [ ŒΩ R‚Ä≤ ]
            case‚Ä≤
               with step ((·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏))) ((swap *ÃÉ) R) | step (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) R‚Ä≤ |
                    inspect (step ((·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏)))) ((swap *ÃÉ) R) | inspect (step (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏))) R‚Ä≤
            case‚Ä≤ | ‚óª , S | ‚óª , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | ‚óª , S | [ ._ ‚Ä¢ ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ œÑ ·∂ú ] , S | ‚óª , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ œÑ ·∂ú ] , S | [ ._ ‚Ä¢ ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH

      case :
         braiding (·µá‚àá·∂ú {a = x ‚Ä¢} {œÑ}) {0} (Œ≥‚ÇÅ (ŒΩ·µá·∂ú ùê∏))
         (tgt (E‚Ä≤/E (‚äñ‚ÇÅ (ŒΩ·µá·∂ú ùê∏))) (tgt (ŒΩ·µá E) [ ŒΩ P ])) ‚â° tgt (E/E‚Ä≤ (‚äñ‚ÇÅ (ŒΩ·µá·∂ú ùê∏))) (tgt (ŒΩ·∂ú E‚Ä≤) [ ŒΩ P ])
      case
         with step E‚Ä≤ P | step E P | inspect (step E‚Ä≤) P | inspect (step E) P
      ... | ‚óª , R‚Ä≤ | ‚óª , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | ‚óª , R‚Ä≤ | [ ._ ‚Ä¢ ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ œÑ ·∂ú ] , R‚Ä≤ | ‚óª , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ œÑ ·∂ú ] , R‚Ä≤ | [ ._ ‚Ä¢ ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)

   module ‚Ä¢x-‚Ä¢x‚å©y‚å™
      {Œì P‚ÇÄ R‚ÇÄ R‚Ä≤‚ÇÄ} {x x‚Ä≤ y : Name Œì} {E : P‚ÇÄ ‚Äî[ (‚Ä¢ ·¥ø.push x) ·µá - _ ]‚Üí R‚ÇÄ}
      {E‚Ä≤ : P‚ÇÄ ‚Äî[ ‚Ä¢ ·¥ø.push x‚Ä≤ ‚å© ·¥ø.push y ‚å™ ·∂ú - _ ]‚Üí R‚Ä≤‚ÇÄ} (ùê∏ : E ‚å£‚ÇÅ[ ·µá‚àá·∂ú ] E‚Ä≤) (P : ‚Üì P‚ÇÄ)
      (let P‚Ä≤‚ÇÄ = tgt‚ÇÅ (‚äñ‚ÇÅ ùê∏); P‚Ä≥‚ÇÄ = tgt‚ÇÇ (‚äñ‚ÇÅ ùê∏))
      (IH : braiding (·µá‚àá·∂ú {a = ‚Ä¢ ·¥ø.push x} {‚Ä¢ ·¥ø.push x‚Ä≤ ‚å© ·¥ø.push y ‚å™}) {0} (Œ≥‚ÇÅ ùê∏)
            (tgt (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏)) (tgt E P)) ‚â° tgt (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) (tgt E‚Ä≤ P))
      where

      private
         module _
            (R : ‚Üì R‚ÇÄ) (R‚Ä≤ : ‚Üì R‚Ä≤‚ÇÄ) (‚â°R : tgt E P ‚â° R) (‚â°R‚Ä≤ : tgt E‚Ä≤ P ‚â° R‚Ä≤) where

            case‚Ä≤ :
               braiding (·µá‚àá·∂ú {a = ‚Ä¢ x} {‚Ä¢ x‚Ä≤ ‚å© y ‚å™}) {0} (cong ŒΩ_ (cong (·¥ø.swap *) (Œ≥‚ÇÅ ùê∏)))
               (tgt (ŒΩ·∂ú (·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏))) [ ŒΩ (swap *ÃÉ) R ]) ‚â° tgt (ŒΩ·µá E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) [ ŒΩ R‚Ä≤ ]
            case‚Ä≤
               with step ((·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏))) ((swap *ÃÉ) R) | step (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) R‚Ä≤ |
                    inspect (step ((·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏)))) ((swap *ÃÉ) R) | inspect (step (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏))) R‚Ä≤
            case‚Ä≤ | ‚óª , S | ‚óª , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | ‚óª , S | [ ‚Ä¢ ._ Ôπô ‚óª Ôπö ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | ‚óª , S | [ ‚Ä¢ ._ Ôπô [ .·¥∫.zero ] Ôπö ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ ‚Ä¢ ._ ‚å© ‚óª ‚å™ ·∂ú ] , S | ‚óª , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ ‚Ä¢ ._ ‚å© [ ._ ] ‚å™ ·∂ú ] , S | ‚óª , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ ‚Ä¢ ._ ‚å© ‚óª ‚å™ ·∂ú ] , S | [ ‚Ä¢ ._ Ôπô ‚óª Ôπö ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ ‚Ä¢ ._ ‚å© ‚óª ‚å™ ·∂ú ] , S | [ ‚Ä¢ ._ Ôπô [ .·¥∫.zero ] Ôπö ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ ‚Ä¢ ._ ‚å© [ ._ ] ‚å™ ·∂ú ] , S | [ ‚Ä¢ ._ Ôπô ‚óª Ôπö ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ ‚Ä¢ ._ ‚å© [ ._ ] ‚å™ ·∂ú ] , S | [ ‚Ä¢ ._ Ôπô [ .·¥∫.zero ] Ôπö ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH

      case :
         braiding (·µá‚àá·∂ú {a = ‚Ä¢ x} {‚Ä¢ x‚Ä≤ ‚å© y ‚å™}) {0} (Œ≥‚ÇÅ (ŒΩ·µá·∂ú ùê∏))
         (tgt (E‚Ä≤/E (‚äñ‚ÇÅ (ŒΩ·µá·∂ú ùê∏))) (tgt (ŒΩ·µá E) [ ŒΩ P ])) ‚â° tgt (E/E‚Ä≤ (‚äñ‚ÇÅ (ŒΩ·µá·∂ú ùê∏))) (tgt (ŒΩ·∂ú E‚Ä≤) [ ŒΩ P ])
      case
         with step E‚Ä≤ P | step E P | inspect (step E‚Ä≤) P | inspect (step E) P
      ... | ‚óª , R‚Ä≤ | ‚óª , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | ‚óª , R‚Ä≤ | [ ‚Ä¢ ._ Ôπô ‚óª Ôπö ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | ‚óª , R‚Ä≤ | [ ‚Ä¢ ._ Ôπô [ .·¥∫.zero ] Ôπö ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ ‚Ä¢ ._ ‚å© ‚óª ‚å™ ·∂ú ] , R‚Ä≤ | ‚óª , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ ‚Ä¢ ._ ‚å© [ ._ ] ‚å™ ·∂ú ] , R‚Ä≤ | ‚óª , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ ‚Ä¢ ._ ‚å© ‚óª ‚å™ ·∂ú ] , R‚Ä≤ | [ ‚Ä¢ ._ Ôπô ‚óª Ôπö ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ ‚Ä¢ ._ ‚å© ‚óª ‚å™ ·∂ú ] , R‚Ä≤ | [ ‚Ä¢ ._ Ôπô [ .·¥∫.zero ] Ôπö ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ ‚Ä¢ ._ ‚å© [ ._ ] ‚å™ ·∂ú ] , R‚Ä≤ | [ ‚Ä¢ ._ Ôπô ‚óª Ôπö ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ ‚Ä¢ ._ ‚å© [ ._ ] ‚å™ ·∂ú ] , R‚Ä≤ | [ ‚Ä¢ ._ Ôπô [ .·¥∫.zero ] Ôπö ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] =
         case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)

   module ‚Ä¢x-œÑ
      {Œì P‚ÇÄ R‚ÇÄ R‚Ä≤‚ÇÄ} {x : Name Œì} {E : P‚ÇÄ ‚Äî[ (‚Ä¢ ·¥ø.push x) ·µá - _ ]‚Üí R‚ÇÄ}
      {E‚Ä≤ : P‚ÇÄ ‚Äî[ œÑ ·∂ú - _ ]‚Üí R‚Ä≤‚ÇÄ} (ùê∏ : E ‚å£‚ÇÅ[ ·µá‚àá·∂ú ] E‚Ä≤) (P : ‚Üì P‚ÇÄ)
      (let P‚Ä≤‚ÇÄ = tgt‚ÇÅ (‚äñ‚ÇÅ ùê∏); P‚Ä≥‚ÇÄ = tgt‚ÇÇ (‚äñ‚ÇÅ ùê∏))
      (IH : braiding (·µá‚àá·∂ú {a = ‚Ä¢ ·¥ø.push x} {œÑ}) {0} (Œ≥‚ÇÅ ùê∏)
            (tgt (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏)) (tgt E P)) ‚â° tgt (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) (tgt E‚Ä≤ P))
      where

      private
         module _
            (R : ‚Üì R‚ÇÄ) (R‚Ä≤ : ‚Üì R‚Ä≤‚ÇÄ) (‚â°R : tgt E P ‚â° R) (‚â°R‚Ä≤ : tgt E‚Ä≤ P ‚â° R‚Ä≤) where

            case‚Ä≤ :
               braiding (·µá‚àá·∂ú {a = ‚Ä¢ x} {œÑ}) {0} (cong ŒΩ_ (cong (·¥ø.swap *) (Œ≥‚ÇÅ ùê∏)))
               (tgt (ŒΩ·∂ú (·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏))) [ ŒΩ (swap *ÃÉ) R ]) ‚â° tgt (ŒΩ·µá E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) [ ŒΩ R‚Ä≤ ]
            case‚Ä≤
               with step ((·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏))) ((swap *ÃÉ) R) | step (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏)) R‚Ä≤ |
                    inspect (step ((·¥ø.swap *·∂ú) (E‚Ä≤/E (‚äñ‚ÇÅ ùê∏)))) ((swap *ÃÉ) R) | inspect (step (E/E‚Ä≤ (‚äñ‚ÇÅ ùê∏))) R‚Ä≤
            case‚Ä≤ | ‚óª , S | ‚óª , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | ‚óª , S | [ ‚Ä¢ ._ Ôπô ‚óª Ôπö ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | ‚óª , S | [ ‚Ä¢ ._ Ôπô [ .·¥∫.zero ] Ôπö ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ œÑ ·∂ú ] , S | ‚óª , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ œÑ ·∂ú ] , S | [ ‚Ä¢ ._ Ôπô ‚óª Ôπö ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH
            case‚Ä≤ | [ œÑ ·∂ú ] , S | [ ‚Ä¢ ._ Ôπô [ .·¥∫.zero ] Ôπö ·µá ] , S‚Ä≤ | [ ‚â°S ] | [ ‚â°S‚Ä≤ ] =
               base ùê∏ P R R‚Ä≤ S S‚Ä≤ ‚â°R ‚â°R‚Ä≤ (,-inj‚ÇÇ ‚â°S) (,-inj‚ÇÇ ‚â°S‚Ä≤) IH

      case :
         braiding (·µá‚àá·∂ú {a = ‚Ä¢ x} {œÑ}) {0} (Œ≥‚ÇÅ (ŒΩ·µá·∂ú ùê∏))
         (tgt (E‚Ä≤/E (‚äñ‚ÇÅ (ŒΩ·µá·∂ú ùê∏))) (tgt (ŒΩ·µá E) [ ŒΩ P ])) ‚â° tgt (E/E‚Ä≤ (‚äñ‚ÇÅ (ŒΩ·µá·∂ú ùê∏))) (tgt (ŒΩ·∂ú E‚Ä≤) [ ŒΩ P ])
      case
         with step E‚Ä≤ P | step E P | inspect (step E‚Ä≤) P | inspect (step E) P
      ... | ‚óª , R‚Ä≤ | ‚óª , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | ‚óª , R‚Ä≤ | [ ‚Ä¢ ._ Ôπô ‚óª Ôπö ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | ‚óª , R‚Ä≤ | [ ‚Ä¢ ._ Ôπô [ .·¥∫.zero ] Ôπö ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ œÑ ·∂ú ] , R‚Ä≤ | ‚óª , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ œÑ ·∂ú ] , R‚Ä≤ | [ ‚Ä¢ ._ Ôπô ‚óª Ôπö ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
      ... | [ œÑ ·∂ú ] , R‚Ä≤ | [ ‚Ä¢ ._ Ôπô [ .·¥∫.zero ] Ôπö ·µá ] , R | [ ‚â°R‚Ä≤ ] | [ ‚â°R ] = case‚Ä≤ R R‚Ä≤ (,-inj‚ÇÇ ‚â°R) (,-inj‚ÇÇ ‚â°R‚Ä≤)
